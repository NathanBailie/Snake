"use strict";let animationId1,animationId2,canvas=document.querySelector("canvas"),context=canvas.getContext("2d"),scoreWindow=document.querySelector(".scoreWindow"),scoreText=document.querySelector(".scoreWindow p"),restartButton=document.querySelector(".scoreWindow__restart"),cellSize=17,count=0,snake={dir:"right",body:[{x:119,y:119},{x:119-cellSize,y:119},{x:119-2*cellSize,y:119}]},apple={x:getRandomNum(0,29)*cellSize,y:getRandomNum(0,29)*cellSize},score=0,condition="game";function toPlayGame(){let{dir:e}=snake,t=snake.body[0],{body:o}=snake;animationId1=requestAnimationFrame(toPlayGame),++count<4||(count=0,context.clearRect(0,0,canvas.width,canvas.height),drawFood(),o.forEach(((e,o)=>{context.fillStyle="darkorange",context.fillRect(e.x,e.y,cellSize-1,cellSize-1),0===o&&e.x===apple.x&&e.y===apple.y&&(score+=1),0!==o&&e.x===apple.x&&e.y===apple.y&&(apple.x=getRandomNum(0,29)*cellSize,apple.y=getRandomNum(0,29)*cellSize),0!==o&&1!==o&&t.x===e.x&&t.y===e.y&&(condition="finish",cancelAnimationFrame(animationId1),cancelAnimationFrame(animationId2),scoreText.textContent=score,scoreWindow.style.transform="translate(-50%, -50%)"),toMoveThroughTheWall(e)})),toDrawTheMovement(snake))}function getRandomNum(e,t){return Math.floor(Math.random()*(t-e+1))+e}function drawFood(){context.fillStyle="orangered",context.fillRect(apple.x,apple.y,cellSize-1,cellSize-1)}function toMoveThroughTheWall(e){e.x>=canvas.width?e.x=0:e.x<0&&(e.x=canvas.width-cellSize),e.y>=canvas.height?e.y=0:e.y<0&&(e.y=canvas.height-cellSize)}function toDrawTheMovement(e){let t=e.body[0];toMove(e,t),e.body.pop(),t.x===apple.x&&t.y===apple.y&&toMove(e,t)}function toMove(e,t){let{body:o,dir:n}=e;switch(n){case"right":o.unshift({x:t.x+cellSize,y:t.y});break;case"left":o.unshift({x:t.x-cellSize,y:t.y});break;case"up":o.unshift({x:t.x,y:t.y-cellSize});break;case"down":o.unshift({x:t.x,y:t.y+cellSize})}}function toChangeTheDir(e){document.addEventListener("keydown",(t=>{"ArrowRight"!==t.key&&"d"!==t.key&&"в"!==t.key||"left"===e.dir||(e.dir="right",toDrawTheMovement(e)),"ArrowLeft"!==t.key&&"a"!==t.key&&"ф"!==t.key||"right"===e.dir||(e.dir="left",toDrawTheMovement(e)),"ArrowUp"!==t.key&&"w"!==t.key&&"ц"!==t.key||"down"===e.dir||(e.dir="up",toDrawTheMovement(e)),"ArrowDown"!==t.key&&"s"!==t.key&&"ы"!==t.key||"up"===e.dir||(e.dir="down",toDrawTheMovement(e))}))}toChangeTheDir(snake),"game"===condition&&(animationId2=requestAnimationFrame(toPlayGame)),restartButton.addEventListener("click",(()=>{context.clearRect(0,0,canvas.width,canvas.height),score=0,scoreWindow.style.transform="translate(-50%, 100%)",count=0,snake={dir:"right",body:[{x:119,y:119},{x:119-cellSize,y:119},{x:119-2*cellSize,y:119}]},apple={x:getRandomNum(0,29)*cellSize,y:getRandomNum(0,29)*cellSize},condition="game",animationId2=requestAnimationFrame(toPlayGame),toChangeTheDir(snake)}));